<?php
 namespace Softleister\Pdfncattachment; use Contao\Config; use Contao\StringUtil; use Contao\Database; use Contao\FilesModel; use Contao\System; use Contao\Image\ResizeConfiguration; use Contao\Controller; use Contao\Environment; use Contao\Input; use Contao\File; use Symfony\Component\VarDumper\VarDumper; define("\x4c\111\x5a\105\116\x5a", "\x4c\151\x63\145\x6e\x63\145"); define("\120\x52\x4f\104\x55\x43\124\x5f\x4e\103", "\x70\144\x66\x6e\x63\141\164\x74\141\143\x68\x6d\x65\x6e\x74"); define("\x76\116\132\x70\152\130\172\x74\105\126\x4b\x49\151\x71", "\61\62\x33\64\x39\x35\66\x37\70\x39\x30\x31\62\70\63\64\65\66\67"); define("\x49\115\107\x44\125\x4d\x4d\131", "\144\141\x74\x61\72\x69\x6d\141\147\145\x2f\160\156\147\73\142\141\163\x65\66\64\54\151\x56\x42\x4f\122\167\x30\113\107\x67\x6f\x41\x41\x41\x41\116\x53\125\150\105\125\147\101\x41\101\112\x59\101\x41\101\101\61\103\x41\x49\x41\101\101\x41\163\x36\x34\x58\x31\x41\101\x41\x41\x47\130\122\106\127\110\122\124\142\x32\132\x30\144\x32\x46\171\x5a\121\102\102\132\107\71\x69\x5a\123\102\x4a\x62\127\x46\156\132\126\112\x6c\x59\x57\122\65\143\x63\x6c\154\x50\101\101\101\103\x30\170\x4a\122\105\106\x55\145\116\x72\x73\130\x47\154\130\x32\172\x6f\121\x6a\x52\x7a\x6a\67\101\x74\x72\157\x66\x54\57\x2f\x36\144\x2b\67\x6d\166\124\121\x6f\x44\163\151\x51\x4f\62\x33\170\61\116\64\x69\x66\x4a\123\53\124\x45\167\x4f\x73\65\x31\161\x45\143\103\x49\x6f\x6b\x7a\65\63\154\172\x6d\150\x53\x39\57\166\63\67\x37\126\x71\57\115\x33\x44\x71\x55\122\x51\x51\x56\x69\x4e\103\x73\x4a\x71\x56\x42\102\x57\105\106\x61\152\147\162\101\141\106\131\124\126\x71\x43\103\163\111\x4b\x78\107\x42\127\105\x31\x4b\147\151\x72\125\125\x46\131\x51\126\151\x4e\103\163\x4a\x71\126\x42\102\x57\64\x39\152\x68\161\162\70\x49\111\x66\x42\120\53\x33\x74\105\167\63\150\120\x79\x72\124\143\53\x51\x58\x65\x62\x72\146\x43\167\x64\126\157\x68\123\x4b\x4c\x35\113\62\117\170\145\126\x53\x4b\127\166\113\x72\131\130\70\x77\130\67\110\101\64\x39\166\117\122\121\x70\141\x52\102\x75\x74\x39\x73\x77\x44\x4f\x50\154\115\141\130\x75\x4f\x4f\67\x5a\x6d\146\106\x32\x33\57\144\x54\x6a\x78\x76\x4a\70\63\155\x59\x6e\63\166\105\x49\x41\x68\x65\130\x31\71\x46\x78\163\110\x71\x72\x6b\x73\x37\x57\x67\116\x41\x5a\x77\64\x43\157\x65\171\111\122\x54\172\x50\x45\x38\x36\x70\x44\163\132\x78\x48\x4b\x7a\x73\x62\67\x65\x62\x7a\145\142\x74\71\x58\x57\x39\x57\x75\107\67\x65\x74\x5a\x47\x71\x34\x57\116\x76\107\141\x7a\60\x57\151\x63\145\x52\x37\x4e\x44\x38\120\x38\x4e\x54\105\x42\x69\65\103\147\124\x6f\120\x50\x71\x64\146\x50\x39\162\151\x34\x71\x6e\x59\x38\x2f\166\x36\71\x57\x69\65\x6a\143\x57\x42\x71\x74\71\145\67\166\142\x38\x33\x44\x76\110\x72\170\x34\x2f\x67\x37\x53\x31\61\x61\141\x78\67\x39\53\x31\142\163\71\x6b\115\115\x7a\x44\x41\64\x70\x50\x6e\x35\x2b\146\170\x57\x4b\124\102\x48\x49\130\x68\53\x64\x58\126\71\145\60\164\x5a\107\x63\152\131\151\152\x54\x36\115\145\x50\61\x2b\x31\x57\x56\122\x6f\x73\70\165\x58\x75\x72\156\71\53\x48\x68\61\162\x69\x45\x4a\141\x31\127\167\66\x58\123\60\127\x69\57\x6c\x63\x4d\x79\102\154\121\x46\142\x34\111\155\60\124\157\164\x76\166\x64\67\160\x64\151\x47\x74\156\x72\170\x6b\x48\x68\150\x36\115\146\166\x34\x30\144\x4b\x37\157\x41\x41\x53\x4d\103\x78\x62\x45\x58\x71\131\152\x78\x61\x73\x71\x68\x4b\x6b\67\60\124\x73\172\144\x42\x79\x72\167\171\x79\141\67\x58\131\x74\101\x77\117\x73\x69\x63\144\127\144\x30\x6e\x61\163\146\63\x44\121\x43\x49\x77\141\x4b\x69\153\147\x63\x42\x38\x50\165\x38\x4e\x68\x30\143\x62\63\x39\x62\63\x6e\x78\x34\x66\x63\x55\64\70\x6a\160\116\164\172\142\x75\x6a\x79\165\57\x7a\x36\130\x51\65\156\53\x4d\x74\106\x31\x64\x58\x38\x43\x4d\x35\x32\153\115\114\x5a\x67\151\62\x57\x50\150\x34\112\172\157\x44\112\53\x6c\166\116\x72\126\x73\105\64\124\x45\131\x63\110\151\x39\107\x41\147\x39\x34\x4c\125\125\160\x59\x53\101\x6d\x63\x41\165\x6b\146\x73\x41\166\x6e\103\x37\x45\x62\57\57\x4d\120\x47\x35\61\150\x37\131\167\132\x6d\x39\166\x4c\x79\x2b\53\144\x50\103\x68\120\117\170\x2f\110\105\153\156\x63\123\x55\x6e\x7a\60\x44\x42\156\x69\70\x39\146\x72\66\x46\104\101\163\116\63\111\x39\x7a\x63\x5a\117\x47\x47\114\x52\123\x71\x36\x42\x2f\107\142\172\x52\65\x47\x49\67\x4c\x73\102\101\x59\x77\114\102\x67\x6c\71\103\142\x6b\x72\53\x52\124\x77\x49\x66\x56\x36\65\166\x31\x47\151\x75\70\132\x55\x76\147\146\x52\x6c\160\x43\122\x71\x42\53\103\x53\x44\120\x34\x4a\x69\103\160\x56\61\110\x44\x77\x68\x4d\141\142\x54\x6c\x56\121\111\151\x44\x75\124\x46\x77\x69\x42\152\x65\x44\x53\125\64\x2b\122\x2f\147\64\x45\161\165\x58\x79\70\x63\x38\146\117\x70\65\x4f\x6a\155\x71\x53\132\114\x55\x37\x6e\x57\141\x72\126\x57\143\156\107\x55\126\121\x49\x50\151\101\x56\60\x6c\x77\x4e\114\143\155\x41\170\67\151\57\x64\x58\116\124\x53\x47\x4b\125\x6f\103\x6d\x36\x6b\57\153\154\161\x34\125\x46\101\x35\71\x48\x30\53\142\164\102\x75\x34\125\111\x6a\x31\122\x44\67\107\123\x7a\x46\106\x7a\112\153\x41\152\147\115\171\x4d\x72\x79\70\152\103\x79\131\105\146\104\104\62\x63\x61\x50\152\x2b\124\x6b\106\x66\125\x69\150\154\171\x76\x39\x34\x66\104\x2f\155\x41\x41\x38\x41\x53\110\x63\103\156\102\x62\x68\x67\117\x7a\x38\71\x68\66\x79\x39\120\x54\x34\x46\x4f\124\x34\x41\151\121\151\115\x49\104\x6d\x6a\144\x51\121\127\103\165\107\66\x2f\146\157\126\x2b\150\105\x57\x63\153\x30\170\62\x42\x43\x39\145\120\x6f\122\103\127\x6b\102\166\x4d\105\x6a\x2b\x43\127\112\71\x4b\x79\115\x51\131\x6f\130\x6c\x59\166\107\155\132\171\x59\107\x2b\143\113\x76\x6d\x41\115\x35\101\147\115\142\x51\x35\170\x4e\x4a\x6a\x69\62\x6f\53\115\110\131\147\x4a\x36\104\113\x6f\x5a\70\121\x68\x44\144\x53\107\101\117\x72\171\64\121\104\x6f\x42\x7a\x32\153\x41\101\x45\53\x37\x6d\x45\65\142\67\142\x61\x4e\x41\x6e\x45\145\x46\122\141\x4d\x4c\57\106\x44\117\141\126\x67\x64\161\x62\153\x6a\147\x78\x68\x4c\141\x30\147\147\101\121\114\x4b\x4d\x61\103\x68\x6e\104\x7a\x79\x56\x76\127\x64\x68\104\x51\x65\x72\107\147\x5a\x31\131\167\x38\x32\x52\x6d\160\x70\157\x43\53\126\113\x6b\163\110\131\62\x6a\x52\124\103\60\x54\125\101\170\62\120\70\163\x46\110\161\x49\124\153\66\x59\147\113\x41\x33\x45\62\111\71\x67\116\163\145\x62\62\62\x6a\111\152\x52\x55\x61\116\x4d\x4f\x6b\x50\160\111\x4b\x57\x34\130\x72\x77\165\124\101\x31\x6f\107\x61\x66\110\x30\x34\x4c\114\161\113\70\x30\x6d\x6b\62\156\145\106\x41\153\111\x69\120\124\x62\124\130\65\101\x59\53\x41\x7a\x33\124\61\171\x4d\145\107\141\x4c\x4d\155\167\x69\x71\x6c\67\x66\x71\102\64\x55\147\x59\166\x77\117\x65\115\111\162\x67\141\132\110\x64\70\x7a\106\167\150\x6e\141\63\151\60\x42\x34\x2f\x65\x55\x4c\65\x32\61\x2f\102\x35\x30\65\x6b\71\x55\121\x53\x69\146\x32\125\x6b\x43\147\147\150\x74\x4a\102\x6b\111\126\x56\70\124\x4c\165\x56\162\166\x73\x49\171\61\125\x51\124\145\x41\x53\x32\x4a\64\x53\143\x64\x63\x6c\63\64\124\x4b\x67\x49\x6e\125\110\132\106\x4c\105\x4b\112\x6c\x49\63\x45\x73\145\x45\103\x71\x72\65\145\x2b\x78\x43\105\x66\53\163\x41\112\x41\117\146\110\x42\x78\147\121\145\x45\x55\165\x4b\150\x56\x4e\63\66\141\65\x4b\113\x6e\x52\x55\161\156\x42\65\117\172\114\x42\x43\103\x48\x32\162\155\101\x35\x2b\141\103\121\157\152\x36\125\130\x6e\143\71\x6d\x71\x76\x6e\x69\x52\144\x43\x42\165\165\x4e\x30\x65\172\x31\152\125\x34\x69\126\x63\163\x66\x63\x39\102\x79\53\x2f\126\130\130\x4c\146\x49\121\x72\x64\x61\x5a\64\x6c\x63\117\x44\x75\102\71\x66\156\x6e\x4a\x57\160\166\60\144\x58\71\x44\125\151\106\x4c\141\x2f\x2f\x46\105\150\154\x64\104\x45\x34\120\61\x78\x64\x7a\125\x62\x77\111\150\x58\x58\x72\x39\123\117\157\x44\x5a\x54\x44\153\x44\x6a\x63\126\66\x66\146\x68\x38\146\172\155\x6b\x32\x76\60\146\x42\x56\x48\x79\64\x74\162\x4a\71\142\x71\141\107\104\112\x63\x54\144\x4b\x71\x68\145\x34\121\156\112\x4c\164\x54\x52\x79\x66\125\124\161\142\x47\172\132\101\x69\170\63\154\155\152\64\142\x68\165\x58\x48\x6b\x42\x7a\167\x61\126\151\101\116\153\112\x4a\x4e\66\x4d\170\x41\145\x42\x53\110\151\154\x76\105\x38\x4c\123\x41\156\x4e\x78\x4c\123\x45\104\125\x48\111\x41\123\x4f\147\126\145\171\127\104\164\142\x59\x62\x4b\125\x32\103\x7a\x75\111\131\x34\155\x67\x31\x54\112\103\64\x4c\121\x32\x6d\x72\x5a\x35\x35\x55\116\x49\123\171\147\x30\x55\x44\70\x59\101\65\x47\x6b\x55\x39\103\x57\x4f\166\63\144\170\117\103\x51\112\125\x73\122\101\x59\x5a\106\145\x55\x79\x51\x75\113\x78\61\154\x57\150\112\155\x76\170\x38\121\x53\64\x4d\151\114\x6f\142\x32\53\61\x33\123\60\121\x6e\121\x53\153\102\161\57\110\151\x5a\123\x78\113\x46\60\144\66\x42\103\x53\x56\142\151\165\x5a\131\x6e\x53\x68\x76\x66\156\114\x2f\x55\70\110\164\115\102\162\x4b\156\x41\170\x64\x55\x56\x36\x46\x4c\x36\x5a\x64\x4d\x70\x56\147\152\x4b\101\116\x56\121\62\143\x52\x6d\164\x51\x72\x32\116\145\147\126\x47\120\142\x2b\143\x6f\x50\65\x4f\161\125\124\x52\x52\x58\127\x63\124\x67\x64\x56\x49\153\115\101\x47\166\x47\x76\x43\155\113\x6f\105\156\x77\147\122\x51\163\x6c\x61\103\114\110\x48\x38\67\x48\113\x71\141\161\x7a\x72\101\x49\112\x47\x36\65\122\145\120\x6f\x4b\x2b\x42\x6e\x63\126\x6b\126\146\116\124\66\161\166\x32\121\153\147\64\x44\x4c\143\163\x62\x31\x43\124\x68\150\x56\x54\117\66\x35\150\x51\164\x79\x65\x39\112\x59\167\x51\126\130\124\64\121\x6f\113\130\121\x70\x6d\x56\x57\123\x77\x4a\152\171\153\x75\x37\143\131\x70\x76\x57\x74\x54\153\146\x4e\x4a\143\x68\62\x6b\x59\123\163\x56\x71\x6b\121\61\x6f\x70\156\x70\x55\x39\x50\124\71\117\130\x6c\64\x50\131\121\104\117\x51\126\x38\102\151\101\157\166\163\x2f\x76\115\132\x4b\141\x77\161\154\102\x42\161\x45\147\143\x46\x6c\x58\x34\126\153\157\x55\x44\152\101\x30\x66\x57\x73\167\x51\x46\162\x32\144\x68\x34\153\142\102\x52\121\107\124\105\x32\57\131\x46\x4e\x74\x36\x55\x75\61\x35\x4e\144\170\x46\x6f\x76\106\150\61\x48\105\104\170\67\x6c\63\126\x52\x49\x55\161\x6f\x53\70\144\x6a\64\x44\x4e\131\117\116\x77\x56\x33\x35\53\170\152\154\124\60\x4e\x51\63\x71\147\125\150\x4b\53\131\125\67\127\x49\x58\107\107\112\112\53\105\x46\x53\x62\172\x48\x44\x37\x4d\x68\61\60\x70\65\x41\123\111\121\165\x4e\144\x48\107\x6c\163\x4b\x65\103\132\x61\x6b\x32\x4c\160\142\141\126\x70\x64\x48\57\146\112\x33\x6a\x63\x43\62\104\142\65\150\164\x69\x76\x52\x73\x30\63\x43\x50\x52\164\x69\147\62\x34\116\62\62\x37\152\151\x78\x32\122\x6b\105\x58\x44\160\122\161\125\107\126\x42\131\155\x61\x33\x6a\x4f\63\x52\155\x4d\101\111\x6b\106\x50\x38\160\x6b\x6f\x5a\x52\146\x37\x2b\70\67\150\143\x72\143\117\151\x39\x7a\x53\60\x56\x51\143\x43\113\x34\x37\x77\x6b\x69\x76\153\x37\x44\71\x39\x58\x72\x62\x33\150\144\147\162\x44\x67\64\161\101\153\170\x6f\125\x41\130\171\x41\x2f\152\105\141\127\x56\112\103\x61\x58\x37\x5a\x62\x6b\60\x62\112\66\161\103\x54\x61\x50\162\x43\171\132\x4e\x4e\121\x32\160\x70\61\x44\101\x46\x63\131\x67\x45\x48\132\x54\x64\x30\x54\x31\122\112\125\x4f\157\x6c\x70\x64\151\63\x51\x65\x45\66\x75\x6e\147\x52\145\x73\x46\x75\121\x7a\x57\155\x65\x76\160\131\x4a\167\152\160\x71\x49\154\x5a\x4a\x68\115\x73\x71\x48\154\x63\153\153\154\141\x63\126\x71\165\143\x41\x72\71\x47\x4a\155\x4a\x50\x4e\71\x4d\x74\155\60\153\167\x7a\x50\172\67\x76\71\166\x6a\x44\x69\x74\x4f\70\x2f\120\x7a\x34\107\x70\172\x58\x46\x66\104\66\x45\124\x50\105\150\105\124\130\x79\121\x63\x72\107\x6c\x51\x4b\x78\156\157\x4a\105\x42\x67\x61\125\x65\165\144\121\151\111\x36\104\143\x4d\107\125\x65\x37\62\145\x6f\x31\70\57\x73\x64\157\x5a\x71\157\104\x73\70\172\167\156\163\71\132\170\x63\160\x7a\120\x62\115\144\61\x79\x72\113\x2f\156\x55\141\64\x4c\x6f\x78\x4d\x52\x59\x69\141\x5a\x52\x54\x64\x46\106\x49\105\150\x65\163\130\x38\155\162\160\x52\x41\x58\146\130\124\x2f\x70\170\x54\154\x57\117\60\70\x76\150\x31\x4c\x38\63\164\102\111\x78\x59\131\x64\x71\x54\x45\x2b\x6b\x65\x36\x57\x42\x4b\107\123\163\53\146\x48\x4f\123\107\x35\124\103\110\x38\157\x41\x52\155\122\127\131\x76\x78\171\x6a\63\x4b\x30\153\x51\157\105\x79\162\122\x48\141\102\x77\x33\x66\x32\x56\123\x52\x31\65\x75\172\x6c\x78\x52\66\131\124\66\123\61\x4a\x64\x2f\x61\x55\57\x30\141\x6f\121\x35\x70\x59\160\x72\x52\x55\x46\x31\x4e\x6c\x6b\x61\152\120\121\165\154\x49\x4a\x54\x62\x68\x30\x47\x5a\x69\x63\167\110\x44\111\117\x67\164\x4d\x54\x43\x66\x56\105\53\x71\x72\150\x78\141\x6f\155\131\172\121\131\130\x46\60\x6c\x6d\x69\167\151\147\x64\155\x33\x78\122\122\126\x65\102\x37\153\71\x6d\112\x76\x7a\x2f\143\154\156\x47\127\x4c\65\x45\x4a\64\x42\x51\x74\143\116\x74\71\x76\x55\x43\121\61\132\x47\x6f\x32\x73\x65\x39\145\x35\x77\x6d\x6c\x75\64\x58\x6d\63\x39\x2f\x66\x55\x63\x4a\x78\x4c\x78\x4c\x48\x52\156\x31\x2b\x2f\160\x70\x4f\x4a\x71\x69\x4a\111\x54\151\147\x69\104\x6f\144\161\111\x78\63\x77\x41\60\116\65\x65\130\x6f\x79\x4e\150\x6f\x2f\x50\107\103\x56\146\x72\53\146\x68\x53\112\104\152\x6f\124\61\141\x54\167\53\x33\144\x58\57\142\171\x44\x30\x50\x4c\144\x65\x33\66\x5a\62\x75\x38\157\113\124\156\161\65\x4f\x61\164\x4d\x4a\x53\x57\x75\x47\x59\60\x30\x5a\x51\152\71\114\141\x32\x6a\x33\x44\x67\x4d\x67\112\153\156\127\x43\164\145\125\x52\x75\x46\x4f\126\x55\144\104\x49\x66\147\161\x37\65\151\x37\161\x78\x41\x6a\66\x50\x52\x71\53\x2f\104\x46\154\120\166\152\122\105\x79\x4a\x35\x4d\x4a\111\115\x54\115\172\x79\x49\x31\67\x39\x44\53\x4a\114\61\143\141\166\x52\x79\x75\141\x35\127\112\x42\x44\103\x6d\x34\127\x36\x4e\x73\x44\x33\167\162\x2f\x56\x39\160\x31\x6b\53\x52\102\x36\x38\x74\115\x4f\166\164\64\106\163\x70\125\x4e\161\x4d\61\62\117\172\x5a\105\x47\x42\101\70\x78\53\x58\126\x46\142\112\x4d\152\130\x7a\x42\x51\64\142\150\x38\x33\147\70\156\x30\64\x37\166\122\67\60\152\x37\x75\x45\x38\x43\x49\x56\x2b\x35\x5a\x4c\67\161\x6c\115\112\x61\127\x57\x74\67\x35\x34\111\x36\x57\x32\102\143\x30\130\146\x76\166\x6d\67\x71\64\63\x47\117\x43\110\143\x69\102\x55\x6b\x37\x42\111\x66\154\x37\105\155\x55\66\x6a\170\104\117\102\53\106\106\112\62\x74\x34\105\147\70\x42\157\151\x57\104\123\155\171\x79\x79\65\x41\x67\111\150\161\x69\x57\61\165\112\x43\104\67\127\x58\66\x52\114\x76\144\x4c\x75\x58\116\x7a\144\152\166\x5a\x57\x55\x66\60\x42\x4f\x4f\130\x6c\x2b\152\x6b\x73\107\130\114\155\157\x37\132\163\x42\x55\x37\121\x6e\104\101\x46\62\x77\x36\x49\112\163\x58\x62\x55\x64\x54\107\143\x55\x35\x6d\130\124\x63\141\156\x72\146\x67\x75\105\x4d\x4b\162\66\x53\145\x4c\x5a\x4a\115\x5a\x41\114\x41\70\115\x66\146\107\107\60\61\147\146\104\126\150\62\x56\146\111\150\x36\117\161\x74\x2b\163\x61\164\162\126\x61\x4c\162\x6e\53\157\161\x36\104\147\57\125\110\x41\x37\161\x4c\145\110\147\x77\x47\67\161\x46\x58\x55\154\63\166\x78\171\125\x37\120\114\66\165\156\105\x6f\x57\x70\71\125\x7a\123\x6d\57\x7a\x4b\x30\x62\x69\x70\145\x34\151\x49\x42\105\164\x49\x78\x51\x75\x73\x66\70\x78\151\x51\165\x71\x68\153\166\144\150\x4d\112\121\114\x35\x4d\x71\145\x6f\x4e\x67\x39\x50\x54\x50\x72\x37\x30\x53\103\111\103\x69\x66\146\x36\146\130\101\154\127\x47\x53\x4e\x38\x78\x59\x37\x58\x61\105\x6b\102\x30\145\126\126\x65\114\162\62\61\x75\x73\101\106\146\x30\115\122\x7a\x56\116\122\x35\101\61\126\142\117\x76\126\111\x64\x73\x53\x70\132\112\x30\x46\120\150\110\171\x53\160\x66\x34\x35\x4e\53\x70\63\124\127\123\x45\153\144\x78\122\x76\131\x65\113\71\161\105\x46\60\x5a\124\162\x5a\x2f\106\x65\x31\x47\120\122\x62\150\145\x71\104\110\103\161\103\163\117\144\124\141\146\170\117\153\113\66\102\x4e\x43\121\x64\162\145\142\x69\x69\111\117\x66\57\x66\164\x47\71\x36\171\x6d\105\65\x39\63\x34\x39\x62\166\x49\63\x4a\x55\146\x7a\122\125\124\102\x74\x47\130\124\x35\111\x32\162\x4d\61\x31\x49\x2f\117\x73\112\111\x6e\61\66\x48\x55\64\125\x6d\x31\120\x38\x56\107\x49\x70\x70\x66\x48\x41\121\x51\144\x37\157\111\163\x45\67\61\x36\x75\x56\x64\x6a\65\x5a\x47\152\x58\x73\x43\x59\65\157\161\x39\x7a\147\115\167\x33\150\x37\x67\x63\152\142\66\116\x79\x69\x56\66\x2b\x67\147\x51\x35\x2f\x46\102\114\163\x55\112\142\x49\x73\156\53\x2b\141\53\106\57\x48\167\147\62\172\x37\125\124\67\53\171\111\x77\113\60\x4f\141\112\x45\x67\x4b\x66\107\x53\x64\154\66\x41\x36\166\106\x49\x73\x61\106\x4d\x32\103\x6a\60\x49\102\x2f\152\x51\x5a\x44\x79\x50\121\156\x35\x79\124\125\131\132\x76\x57\112\63\60\105\70\x77\x63\x64\x32\61\x30\161\161\x42\x43\123\x39\61\x65\x5a\x6e\x76\x77\65\x65\123\131\142\x39\151\x58\153\x4c\x63\67\x42\160\132\x4c\124\x6f\x72\63\x76\x53\x6d\x45\x4b\x32\x64\160\x39\105\115\x56\144\167\116\x59\x50\x65\124\102\121\x78\x52\71\144\x59\x49\71\x71\172\116\57\x64\x33\x63\x6c\x76\154\x76\167\x7a\x36\x79\122\x48\170\x4d\112\131\125\x4f\64\122\x31\115\150\x6d\127\x69\121\71\x34\x43\156\124\123\x6d\172\106\120\110\x71\x70\53\x49\62\x73\x61\x73\156\x49\x58\142\122\x6c\x39\104\x33\66\x53\57\70\x56\x59\x41\x43\x31\62\x4b\103\63\60\x48\x52\101\x59\167\101\101\101\x41\102\x4a\x52\x55\65\105\162\x6b\x4a\147\147\147\x3d\75"); class pdfnc_helper { protected static $arrProtectflags = array("\x6d\157\x64\x69\x66\171", "\145\x78\164\x72\141\143\164", "\x70\162\x69\x6e\x74", "\x70\x72\151\x6e\164\x2d\x68\151\147\150", "\x63\x6f\x70\171", "\141\156\x6e\157\x74\x2d\146\x6f\x72\x6d\163", "\x66\151\x6c\x6c\x2d\x66\x6f\x72\155\163"); public static function getPdfData($arrPDF, &$arrTokens, $pdfdatei) { $objDB = Database::getInstance(); $hascontent = false; if (class_exists(\Codefog\HasteBundle\StringParser::class)) { $hasteStringParser = new \Codefog\HasteBundle\StringParser(); } if (isset($arrTokens["\x66\x6f\162\x6d\x63\157\x6e\x66\151\x67\137\x69\x64"])) { $objFine = $objDB->prepare("\x53\x45\114\x45\103\124\40\52\40\106\122\117\115\x20\164\x6c\137\x66\157\x72\x6d\x5f\146\151\x65\x6c\x64\40\127\110\x45\122\x45\40\x60\164\171\x70\x65\140\75\x3f\x20\x41\116\104\40\160\x69\144\x3d\77")->execute("\x66\x69\x6e\x65\125\x70\154\x6f\x61\x64\145\162", $arrTokens["\146\157\x72\155\x63\157\x6e\x66\151\147\137\151\144"]); while ($objFine->next()) { $tokenname = "\x66\157\x72\x6d\137" . $objFine->name; if (isset($arrTokens[$tokenname])) { $arrFiles = StringUtil::trimsplit("\x2c", $arrTokens[$tokenname]); $nr = 1; foreach ($arrFiles as $filename) { $arrTokens[$tokenname . "\x5f\43" . $nr] = $filename; $arrTokens[$tokenname . "\137\x23" . $nr . "\x5f\142\x61\163\145\156\141\x6d\145"] = basename($filename); $nr++; } } } $objUpl = $objDB->prepare("\x53\x45\114\x45\x43\124\x20\x2a\40\106\122\x4f\x4d\40\164\x6c\x5f\x66\157\162\x6d\x5f\x66\151\x65\x6c\144\x20\127\x48\x45\x52\105\x20\140\x74\171\160\145\x60\x3d\x3f\x20\101\x4e\104\40\x70\x69\144\75\77")->execute("\165\160\x6c\x6f\141\x64", $arrTokens["\146\x6f\162\x6d\x63\157\x6e\146\151\x67\137\151\144"]); while ($objUpl->next()) { $tokenname = "\146\157\162\155\x5f" . $objUpl->name; if (isset($arrTokens[$tokenname])) { $arrTokens[$tokenname . "\137\142\141\163\x65\156\x61\155\145"] = basename($arrTokens[$tokenname]); } } } $l = array(); $l["\x61\137\x6d\145\164\x61\137\x64\x69\x72"] = "\x6c\x74\162"; $l["\141\x5f\x6d\x65\164\141\137\143\x68\141\162\163\145\164"] = Config::get("\x63\x68\141\162\141\x63\164\x65\x72\123\145\164"); $l["\x61\137\x6d\x65\x74\x61\x5f\x6c\141\x6e\x67\x75\x61\x67\x65"] = substr($GLOBALS["\x54\114\x5f\x4c\101\x4e\x47\x55\101\x47\105"], 0, 2); $l["\167\x5f\x70\141\147\145"] = "\160\x61\x67\145"; $font = PDF_FONT_NAME_MAIN; $pdf = new \setasign\Fpdi\Tcpdf\Fpdi(PDF_PAGE_ORIENTATION, "\155\155", PDF_PAGE_FORMAT, true); $pages = 0; if (!empty($arrPDF["\x76\x6f\x72\x6c\x61\x67\145"]) && file(TL_ROOT . "\57" . $arrPDF["\x76\157\x72\x6c\x61\x67\145"])) { $pages = $pdf->setSourceFile(TL_ROOT . "\57" . $arrPDF["\x76\x6f\x72\154\x61\x67\145"]); } $pdf->SetCreator(PDF_CREATOR . (Self::CDDAC68499E52601E4DBEB210CE9A1A7() ? "\x2c" : "\x2c\x20\x44\x45\x4d\117") . "\40\x63\x6f\x6e\x74\x61\157\x2d\x70\144\x66\x2d\156\143\x2d\x61\x74\x74\141\143\150\155\x65\156\164\55\x62\x75\x6e\144\x6c\145"); $pdf->SetAuthor($arrPDF["\141\x75\x74\x68\x6f\x72"]); $pdf->SetTitle($arrPDF["\x74\151\164\154\x65"]); $pdf->SetSubject($arrPDF["\147\x61\x74\145\164\x69\164\x6c\x65"]); $pdf->setPrintHeader(false); $pdf->setPrintFooter(false); $pdf->SetMargins(0, 0, 0); $pdf->SetAutoPageBreak(true, 0); $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO); $pdf->setLanguageArray($l); $pdf->getAliasNbPages(); $customfont = array("\x52" => false, "\x42" => false, "\x49" => false, "\111\x42" => false); foreach ($customfont as $attr => $status) { if (!empty($arrPDF[$attr]) && file_exists(TL_ROOT . "\x2f" . $arrPDF[$attr])) { $customfont[$attr] = \TCPDF_FONTS::addTTFfont(TL_ROOT . "\57" . $arrPDF[$attr], '', '', 32, TL_ROOT . "\57" . dirname($arrPDF[$attr]) . "\57"); $file_parts = pathinfo(TL_ROOT . "\57" . $arrPDF[$attr]); $pdf->AddFont("\x63\x75\x73\164\x6f\x6d\146\157\156\x74", $attr == "\x52" ? '' : $attr, $file_parts["\144\151\162\x6e\141\155\x65"] . "\x2f" . strtolower($customfont[$attr] . "\x2e\x70\x68\160")); } } $seiten = -1; $where = ''; if ($pdfdatei !== '') { if (!empty($arrPDF["\x6d\165\154\164\151\146\157\x72\x6d"]) && is_array($arrPDF["\155\x75\x6c\164\x69\146\157\x72\x6d"]) && $arrPDF["\x6d\165\154\164\151\x66\x6f\162\x6d"][0]["\142\x65\x64\151\x6e\147\165\x6e\x67"] !== '') { $seiten = array(); foreach ($arrPDF["\155\x75\154\164\x69\146\x6f\x72\155"] as $multi) { if (!Self::checkBedingung($multi, $arrPDF, $arrTokens)) { continue; } $arrBereiche = StringUtil::trimsplit("\54", $multi["\x73\145\x69\x74\145\156"]); foreach ($arrBereiche as $ber) { if (strpos($ber, "\55") == false) { $seiten[] = $ber; } else { $se = StringUtil::trimsplit("\55", $ber); for ($i = $se[0]; $i <= $se[1]; $i++) { $seiten[] = $i; } } } } if (count($seiten) < 1) { unlink(TL_ROOT . "\x2f" . $pdfdatei); return false; } $seiten = array_unique($seiten, SORT_NUMERIC); $where = "\40\x41\116\104\40\160\x61\x67\145\x20\111\116\50" . implode("\54", $seiten) . "\51"; } } $objItems = $objDB->prepare("\123\x45\114\x45\x43\124\x20\x2a\40\106\x52\117\x4d\x20\x74\x6c\x5f\x70\x64\146\156\143\x5f\160\157\163\x69\164\151\157\156\163\x20\x57\x48\x45\x52\x45\40\160\x75\142\x6c\x69\163\150\145\x64\75\x31\x20\x41\x4e\x44\40\160\151\144\75\x3f" . $where . "\x20\x4f\122\x44\x45\122\40\x42\131\40\160\x61\x67\x65\54\40\163\157\x72\164\151\x6e\147")->execute($arrPDF["\x67\x61\164\145\x69\144"]); if ($objItems->numRows < 1 && $pdfdatei !== '') { unlink(TL_ROOT . "\x2f" . $pdfdatei); return false; } if ($objItems->numRows > 0) { $page = 0; $lastpos = array(0, 0); while ($objItems->next()) { $arrItem = array(); $arrItem["\x69\144"] = $objItems->id; $arrItem["\x74\171\160\x65"] = $objItems->type; $arrItem["\160\x69\x63\164\x79\160\145"] = $objItems->pictype; if ($objItems->pictype === "\x75\165\x69\x64") { $picuuid = html_entity_decode($objItems->pictag); if (!\Contao\Validator::isUuid($picuuid)) { $picuuid = trim($picuuid, "\x23"); if (class_exists(\Haste\Util\StringUtil::class)) { $picuuid = \Haste\Util\StringUtil::recursiveReplaceTokensAndTags("\43\x23" . $picuuid . "\x23\43", $arrTokens); } else { $picuuid = $hasteStringParser->recursiveReplaceTokensAndTags("\x23\43" . $picuuid . "\x23\x23", $arrTokens); } $picuuid = trim($picuuid, "\43"); } if (mb_substr($picuuid, 0, 2) === "\x30\170") { $picuuid = mb_substr($picuuid, 2); } if (ctype_xdigit($picuuid) && mb_strlen($picuuid) == 32) { $picuuid = hex2bin($picuuid); } $objPic = FilesModel::findByUuid($picuuid); if ($objPic == null) { continue; } $arrItem["\x70\151\143\x74\x79\160\x65"] = "\146\151\154\x65"; $arrItem["\x70\151\143\x74\x61\x67"] = $objPic->path ?? ''; } else { $objPic = FilesModel::findByUuid($objItems->picture); $arrItem["\x70\x69\143\164\x61\147"] = $objItems->pictag; } $arrItem["\x70\151\143\164\165\162\x65"] = $objPic->path ?? ''; $arrItem["\142\x61\x72\x74\x79\x70\145"] = $objItems->bartype; $arrItem["\x74\x65\170\164\151\164\x65\x6d\x73"] = StringUtil::deserialize($objItems->textitems); $arrItem["\160\x61\x67\145"] = $objItems->page; $arrItem["\x70\157\x73\170\171"] = StringUtil::deserialize($objItems->posxy); $arrItem["\141\x72\x65\x61"] = StringUtil::deserialize($objItems->textarea); $arrItem["\141\154\x69\x67\x6e"] = $objItems->align; $arrItem["\x66\157\x6e\x74\x73\x74\171\154\x65"] = StringUtil::deserialize($objItems->fontstyle); $arrItem["\164\x65\170\164\164\162\x61\156\163\146\x6f\x72\155"] = $objItems->texttransform; $arrItem["\x66\157\x6e\164\163\x69\172\x65"] = $objItems->fontsize; $arrItem["\164\x65\x78\164\143\157\154\x6f\162"] = $objItems->textcolor; $arrItem["\x62\157\162\144\145\x72\x72\151\147\150\x74"] = $objItems->borderright; $arrItem["\161\162\163\x69\172\x65"] = $objItems->qrsize; $arrItem["\142\145\144\x69\x6e\147\x75\156\x67"] = $objItems->bedingung; $arrItem["\x6e\157\142\154\141\156\153\163"] = $objItems->noblanks; if (!empty($arrItem["\x74\145\x78\164\151\x74\145\x6d\163"])) { foreach ($arrItem["\x74\x65\170\164\151\x74\x65\x6d\163"] as $key => $value) { $arrItem["\x74\145\170\x74\151\x74\145\155\x73"][$key]["\146\x65\x6c\x64"] = StringUtil::decodeEntities($value["\146\x65\154\x64"]); $arrItem["\x74\x65\170\164\151\x74\145\x6d\x73"][$key]["\142\x65\144\x69\156\147\165\x6e\x67"] = StringUtil::decodeEntities($value["\142\x65\144\x69\156\147\x75\x6e\147"]); } } if (isset($GLOBALS["\124\114\x5f\x48\117\117\113\123"]["\x70\144\x66\156\x63\137\120\x6f\x73\x69\164\x69\x6f\x6e\163"]) && \is_array($GLOBALS["\124\x4c\137\110\x4f\117\x4b\x53"]["\x70\x64\x66\x6e\x63\137\x50\x6f\x73\151\164\151\x6f\x6e\x73"])) { foreach ($GLOBALS["\x54\x4c\x5f\x48\x4f\x4f\113\123"]["\x70\144\x66\156\x63\x5f\x50\157\x73\x69\164\151\x6f\156\163"] as $callback) { $arrItem = System::importStatic($callback[0])->{$callback[1]}($arrItem); } } $arrItem["\160\x61\147\x65"] = $objItems->page; while ($page != $arrItem["\160\x61\x67\145"]) { if ($page > 0) { Self::demoHinweis($pdf); } if ($arrPDF["\x61\154\x6c\160\141\x67\145\x73"] == 1) { $page++; if (is_array($seiten) && !in_array($page, $seiten)) { continue; } } else { $page = $arrItem["\x70\x61\147\145"]; } $pdf->AddPage(); if ($pages > 0) { if ($page <= $pages) { $pdf->useTemplate($pdf->importPage($page), 0, 0, null, null, true); } else { $pdf->useTemplate($pdf->importPage($pages), 0, 0, null, null, true); } $arrPageDimensions = $pdf->getPageDimensions(); $pageheight = $arrPageDimensions["\x68\153"]; $pagewidth = $arrPageDimensions["\167\x6b"]; } } $text = ''; if ($arrItem["\164\171\160\145"] === "\160\x69\143") { $pos = array(); if (Self::is_relative($arrItem["\x70\157\x73\x78\171"][0])) { $pos[0] = $lastpos[0] + $arrItem["\x70\x6f\163\x78\171"][0]; } else { $pos[0] = $arrItem["\x70\157\163\x78\x79"][0] + $arrPDF["\157\x66\x66\x73\145\x74"][0]; } if (Self::is_relative($arrItem["\x70\x6f\163\x78\171"][1])) { $pos[1] = $lastpos[1] + $arrItem["\x70\157\163\170\x79"][1]; } else { $pos[1] = $arrItem["\160\x6f\x73\x78\x79"][1] + $arrPDF["\x6f\146\x66\x73\145\x74"][1]; } if ($pdfdatei !== '') { if (!Self::checkBedingung($arrItem, $arrPDF, $arrTokens)) { continue; } switch ($arrItem["\160\x69\143\164\x79\160\145"]) { case "\146\151\x6c\x65": $imageFactory = System::getContainer()->get("\x63\157\x6e\164\x61\157\56\x69\155\x61\147\145\56\x69\x6d\141\x67\145\x5f\146\141\143\x74\157\x72\x79"); $image = $imageFactory->create(TL_ROOT . "\57" . $arrItem["\x70\x69\x63\x74\165\x72\145"], array($arrItem["\141\162\145\x61"][0] * 11.8, $arrItem["\141\162\x65\x61"][1] * 11.8, ResizeConfiguration::MODE_CROP)); $src = str_replace("\x25\62\x30", "\40", $image->getUrl(TL_ROOT)); $bildtyp = Self::getimagetype($src); if ($bildtyp != '') { $pdf->Image(TL_ROOT . "\x2f" . $src, $pos[0], $pos[1], $arrItem["\141\x72\x65\141"][0], $arrItem["\x61\162\x65\141"][1], $bildtyp); $hascontent = true; } break; case "\x75\x70\154\157\x61\144": if (class_exists(\Haste\Util\StringUtil::class)) { $png = \Haste\Util\StringUtil::recursiveReplaceTokensAndTags("\x23\x23" . $arrItem["\160\151\x63\x74\141\x67"] . "\x23\43", $arrTokens); } else { $png = $hasteStringParser->recursiveReplaceTokensAndTags("\43\x23" . $arrItem["\x70\x69\143\x74\x61\x67"] . "\43\43", $arrTokens); } if (substr($png, 0, 2) === "\x23\43") { break; } if ($png[0] !== "\x2f") { $png = TL_ROOT . "\x2f" . $png; } $imageFactory = System::getContainer()->get("\x63\157\156\x74\x61\x6f\x2e\151\155\141\147\x65\56\151\155\141\x67\x65\x5f\x66\x61\x63\164\x6f\162\x79"); $image = $imageFactory->create($png, array($arrItem["\141\162\145\x61"][0] * 11.8, $arrItem["\141\x72\145\x61"][1] * 11.8, ResizeConfiguration::MODE_CROP)); $src = str_replace("\x25\x32\60", "\40", $image->getUrl(TL_ROOT)); $bildtyp = Self::getimagetype($src); if ($bildtyp != '') { $pdf->Image(TL_ROOT . "\x2f" . $src, $pos[0], $pos[1], $arrItem["\141\x72\x65\141"][0], $arrItem["\x61\x72\x65\x61"][1], $bildtyp); $hascontent = true; } break; case "\144\141\x74\141": $png = $arrTokens[$arrItem["\160\151\x63\164\x61\147"]]; $png = base64_decode(preg_replace("\43\x5e\x64\141\x74\x61\x3a\151\x6d\141\147\145\x2f\133\x5e\x3b\135\x2b\73\x62\141\x73\x65\66\x34\54\43", '', $png)); $pdf->Image("\x40" . $png, $pos[0], $pos[1], $arrItem["\x61\x72\145\x61"][0], $arrItem["\x61\162\x65\x61"][1], "\120\x4e\107"); $hascontent = true; break; } } else { $png = base64_decode(preg_replace("\43\x5e\144\141\x74\141\x3a\x69\155\141\x67\x65\57\133\x5e\x3b\x5d\53\x3b\x62\141\x73\x65\x36\x34\54\43", '', IMGDUMMY)); $pdf->Image("\x40" . $png, $pos[0], $pos[1], $arrItem["\141\162\145\x61"][0], $arrItem["\141\x72\145\x61"][1], "\120\x4e\x47"); $pdf->SetXY($lastpos[0] = $pos[0], $lastpos[1] = $pos[1]); $pdf->SetTextColor(0, 0, 0); $pdf->writeHTML($arrItem["\160\151\x63\x74\x79\x70\x65"] == "\146\x69\154\x65" ? basename($arrItem["\160\x69\143\x74\165\x72\145"]) : $arrItem["\x70\x69\143\x74\x61\x67"], false, false, true, false, "\x4c"); $hascontent = true; } } else { $fontattr = ''; if (is_array($arrItem["\x66\x6f\x6e\164\x73\x74\x79\154\x65"])) { foreach ($arrItem["\146\x6f\x6e\x74\163\164\x79\x6c\145"] as $attr) { switch ($attr) { case "\151\164\x61\x6c\x69\x63": $fontattr .= "\111"; break; case "\x62\x6f\154\144": $fontattr .= "\x42"; break; } } } switch ($arrItem["\x61\154\151\147\x6e"]) { case "\162\x69\x67\x68\x74": $align = "\122"; break; case "\x63\x65\156\x74\145\x72": $align = "\x43"; break; default: $align = "\114"; } $color = $arrPDF["\164\145\170\164\x63\x6f\x6c\x6f\x72"] != '' ? $arrPDF["\164\x65\170\164\x63\x6f\154\x6f\x72"] : "\60\x30\x30\60\x30\60"; if (!empty($arrItem["\x74\145\x78\x74\x63\157\154\x6f\162"])) { $color = $arrItem["\x74\x65\170\164\143\x6f\154\x6f\162"]; } if (strlen($color) != 6) { if (strlen($color) == 3) { $color = substr($color, 0, 1) . substr($color, 0, 1) . substr($color, 1, 1) . substr($color, 1, 1) . substr($color, 2, 1) . substr($color, 2, 1); } else { $color = "\60\x30\x30\60\60\x30"; } } $r = hexdec(substr($color, 0, 2)); $g = hexdec(substr($color, 2, 2)); $b = hexdec(substr($color, 4, 2)); $pdf->SetTextColor($r, $g, $b); if ($fontattr === "\x42\111") { $fontattr = "\111\x42"; } $fontidx = $fontattr == '' ? "\122" : $fontattr; $pdf->SetFont(empty($customfont[$fontidx]) ? "\150\x65\x6c\x76\x65\164\x69\143\x61" : "\143\165\163\164\x6f\x6d\x66\x6f\x6e\x74", $fontattr, $arrItem["\146\x6f\x6e\x74\x73\151\x7a\x65"]); $text = ''; $blank = $arrItem["\x6e\157\142\154\141\x6e\x6b\163"] ? '' : "\40"; if (is_array($arrItem["\164\145\x78\164\151\164\145\x6d\163"])) { foreach ($arrItem["\164\145\x78\164\x69\x74\145\155\x73"] as $item) { if ($pdfdatei !== '') { if (!Self::checkBedingung($item, $arrPDF, $arrTokens)) { continue; } } if (substr($item["\x66\x65\154\x64"], 0, 1) == "\42") { if (substr($item["\x66\x65\x6c\144"], 1, 1) == "\x2c" || substr($item["\146\145\154\144"], 1, 1) == "\x2e" || substr($item["\x66\x65\x6c\x64"], 1, 1) == "\74") { $text = trim($text); } $text .= Controller::replaceInsertTags(trim($item["\146\145\154\x64"], "\x22"), false) . $blank; } else { if ($pdfdatei !== '') { if (trim($item["\146\145\x6c\144"]) != '') { $text .= "\x23\43" . trim(Controller::replaceInsertTags(trim($item["\146\145\x6c\144"]), false), "\43") . "\x23\43" . $blank; } } else { $text .= Controller::replaceInsertTags(trim($item["\146\x65\x6c\x64"]), false) . $blank; } } } } if ($text === '') { continue; } } while ($page != $arrItem["\160\141\x67\145"]) { Self::demoHinweis($pdf); if ($arrPDF["\141\x6c\154\160\x61\147\x65\163"] == 1) { $page++; if (is_array($seiten) && !in_array($page, $seiten)) { continue; } } else { $page = $arrItem["\x70\x61\147\x65"]; } $pdf->AddPage(); if ($pages > 0) { if ($page <= $pages) { $pdf->useTemplate($pdf->importPage($page), 0, 0, null, null, true); } else { $pdf->useTemplate($pdf->importPage($pages), 0, 0, null, null, true); } $arrPageDimensions = $pdf->getPageDimensions(); $pageheight = $arrPageDimensions["\150\x6b"]; $pagewidth = $arrPageDimensions["\167\x6b"]; } } while ($page != $arrItem["\160\141\147\x65"]) { Self::demoHinweis($pdf); if ($arrPDF["\141\x6c\154\160\x61\147\x65\x73"] == 1) { $page++; if (is_array($seiten) && !in_array($page, $seiten)) { continue; } } else { $page = $arrItem["\x70\x61\147\145"]; } if (!Self::CDDAC68499E52601E4DBEB210CE9A1A7() && $page > 2) { break; } $pdf->AddPage(); if ($page <= $pages) { $pdf->useTemplate($pdf->importPage($page), 0, 0, null, null, true); } else { $pdf->useTemplate($pdf->importPage($pages), 0, 0, null, null, true); } $arrPageDimensions = $pdf->getPageDimensions(); $pagewidth = $arrPageDimensions["\167\x6b"]; } if (!Self::CDDAC68499E52601E4DBEB210CE9A1A7() && $page > 2) { break; } if (Self::is_relative($arrItem["\160\157\x73\x78\x79"][0])) { $borderleft = $lastpos[0] + $arrItem["\x70\x6f\163\170\171"][0]; } else { $borderleft = $arrItem["\160\157\163\x78\171"][0] + $arrPDF["\x6f\146\146\163\145\x74"][0]; } $borderright = 0 - $arrPDF["\x6f\146\x66\x73\145\164"][0]; if ($arrItem["\142\157\162\x64\x65\x72\162\151\x67\150\164"] != '' && is_numeric($arrItem["\142\157\x72\144\x65\x72\162\x69\147\x68\164"]) && $pagewidth - $arrItem["\x62\157\x72\x64\x65\162\162\151\147\x68\164"] > $borderleft - $arrPDF["\x6f\146\146\163\x65\x74"][0]) { $borderright = $arrItem["\142\x6f\162\x64\145\x72\162\x69\147\150\x74"] - $arrPDF["\x6f\146\146\x73\145\x74"][0]; } $pdf->SetMargins($borderleft, 0, $borderright); if (Self::is_relative($arrItem["\160\157\163\170\171"][0])) { $pos[0] = $lastpos[0] + $arrItem["\x70\157\163\170\x79"][0]; } else { $pos[0] = $arrItem["\x70\x6f\x73\x78\171"][0] + $arrPDF["\x6f\x66\x66\163\x65\164"][0]; } if (Self::is_relative($arrItem["\x70\x6f\163\170\171"][1])) { $pos[1] = $lastpos[1] + $arrItem["\160\x6f\163\170\x79"][1]; } else { $pos[1] = $arrItem["\160\157\163\170\171"][1] + $arrPDF["\157\146\x66\163\x65\164"][1]; } $pdf->SetXY($lastpos[0] = $pos[0], $lastpos[1] = $pos[1]); if (class_exists(\Haste\Util\StringUtil::class)) { $text = \Haste\Util\StringUtil::recursiveReplaceTokensAndTags($text, $arrTokens); } else { $text = $hasteStringParser->recursiveReplaceTokensAndTags($text, $arrTokens); } switch ($arrItem["\x74\x79\x70\x65"]) { case "\161\162\143\157\144\145": if (strlen(trim($text)) > 0) { switch ($arrItem["\142\x61\x72\x74\171\160\x65"]) { case "\x44\x41\x54\x41\x4d\101\x54\x52\x49\130": case "\x51\122\103\x4f\x44\105\x2c\x4c": case "\121\x52\103\117\x44\x45\54\115": case "\x51\122\103\x4f\104\x45\x2c\x51": case "\121\x52\x43\117\104\105\54\x48": $style = array("\142\157\x72\x64\145\162" => false, "\x76\160\x61\x64\x64\x69\156\147" => "\141\x75\164\157", "\x68\x70\x61\x64\x64\151\x6e\x67" => "\141\x75\164\157", "\146\147\x63\157\154\157\162" => array($r, $g, $b), "\x62\147\x63\x6f\x6c\157\162" => array(255, 255, 255), "\x6d\x6f\x64\165\x6c\145\137\x77\151\x64\x74\150" => $arrItem["\x71\x72\x73\x69\172\145"], "\x6d\157\144\x75\x6c\x65\137\x68\x65\151\x67\x68\164" => $arrItem["\161\162\x73\151\172\x65"]); $pdf->write2DBarcode(trim($text), $arrItem["\142\141\x72\x74\171\160\x65"], $pos[0], $pos[1], 0, 0, $style, "\116"); break; case "\x50\104\106\64\61\x37": $style = array("\142\157\162\144\145\x72" => false, "\166\x70\141\144\144\x69\x6e\147" => "\141\165\164\x6f", "\150\x70\x61\x64\x64\151\x6e\x67" => "\141\x75\164\157", "\146\x67\x63\157\154\x6f\162" => array($r, $g, $b), "\x62\x67\143\157\x6c\157\162" => array(255, 255, 255)); $pdf->write2DBarcode(trim($text), $arrItem["\x62\x61\x72\164\x79\x70\x65"], $pos[0], $pos[1], 0, $arrItem["\x71\162\163\x69\172\x65"] * 10, $style, "\x4e"); break; default: $style = array("\163\164\x72\145\164\143\150" => false, "\x66\151\x74\167\151\x64\x74\x68" => true, "\142\x6f\x72\x64\145\x72" => false, "\150\x70\x61\x64\144\x69\x6e\147" => "\x61\165\164\157", "\166\x70\x61\x64\x64\151\x6e\x67" => "\x61\165\x74\157", "\x66\x67\x63\157\x6c\x6f\x72" => array($r, $g, $b), "\142\x67\143\157\154\157\162" => array(255, 255, 255), "\x74\145\170\x74" => false); $pdf->write1DBarcode(trim($text), $arrItem["\142\x61\x72\164\171\x70\145"], $pos[0], $pos[1], '', $arrItem["\x71\x72\163\x69\x7a\x65"] * 5, 0.3, $style, "\116"); break; } $hascontent = true; } break; case "\x70\151\x63": break; default: switch ($arrItem["\164\x65\x78\x74\164\162\x61\x6e\163\146\157\162\155"]) { case "\x75\160\160\145\162\143\141\x73\145": $text = mb_convert_case($text, MB_CASE_UPPER, "\x55\124\106\55\70"); break; case "\154\x6f\167\145\x72\x63\x61\x73\145": $text = mb_convert_case($text, MB_CASE_LOWER, "\125\124\x46\55\70"); break; case "\x63\x61\x70\151\164\141\154\x69\172\x65": $text = mb_convert_case($text, MB_CASE_TITLE, "\x55\124\x46\x2d\x38"); break; } $pdf->writeHTML(nl2br(trim($text)) . "\46\156\142\x73\160\x3b", false, false, true, false, $align); $hascontent = true; break; } } } if (Self::CDDAC68499E52601E4DBEB210CE9A1A7() === true || $page < 2) { while ($page < $pages && $arrPDF["\141\154\x6c\160\141\147\x65\163"] == 1) { Self::demoHinweis($pdf); $page++; if (is_array($seiten) && !in_array($page, $seiten)) { continue; } $pdf->AddPage(); $pdf->useTemplate($pdf->importPage($page), 0, 0, null, null, true); } } Self::demoHinweis($pdf); $beUserLoggedIn = false; $beUserLoggedIn = false; $arrVersion = explode("\56", VERSION); if (sha1(session_id() . (!Config::get("\x64\x69\163\x61\x62\x6c\x65\111\x70\103\150\145\x63\x6b") ? Environment::get("\151\x70") : '') . "\102\105\x5f\x55\x53\105\x52\x5f\101\125\124\x48") == Input::cookie("\102\105\137\125\x53\105\x52\137\x41\125\124\x48")) { $beUserLoggedIn = true; } else { if ($arrVersion[1] >= 6) { $beUserLoggedIn = System::getContainer()->get("\143\157\x6e\x74\141\x6f\x2e\x73\145\x63\165\162\x69\x74\171\56\x74\x6f\x6b\x65\156\x5f\x63\x68\x65\143\x6b\x65\162")->hasBackendUser() === true; } } if ($beUserLoggedIn && $arrPDF["\164\157\x6b\x65\156\154\x69\x73\164"] == 1) { $pdf->AddPage(); $pdf->SetTextColor(0, 0, 0); $pdf->SetFont($font, '', 11); $pdf->SetMargins(15, 10, 15); $pdf->SetAutoPageBreak(true, 10); $pdf->SetXY($lastpos[0] = 15, $lastpos[1] = 10); if ($pdfdatei !== '') { $text = "\x41\x76\141\x69\154\141\x62\154\145\x20\124\157\153\x65\x6e\163\x3a\x3c\x62\x72\76\x3c\142\162\x3e\x3c\164\141\142\154\x65\x3e"; $arrTokens["\160\x64\x66\x6e\x63\137\x61\164\x74\x61\143\150\155\x65\156\x74"] = $pdfdatei; $arrTokens["\x70\x64\146\x6e\x63\x5f\144\157\143\x75\155\145\156\x74"] = basename($pdfdatei); foreach ($arrTokens as $token => $content) { $content = trim($content); if (mb_strlen($content) > 200) { $content = mb_substr($content, 0, 196) . "\x20\x2e\56\56"; } $c = preg_replace("\x7e\133\x5e\141\x2d\172\x41\55\132\x30\x2d\x39\x5c\x2d\53\x3d\137\x5c\100\x5c\56\72\x3b\x2c\134\173\x5c\x7d\x5c\x5b\134\x5d\134\x28\134\51\134\134\x2f\42\47\134\x6e\303\xa4\303\xb6\303\xbc\xc3\x84\303\226\xc3\x9c\303\x9f\xe2\x80\246\xc3\xa0\303\xa1\303\242\303\xa9\xc3\xa8\xc3\264\303\xaa\43\40\x5d\x7e\151", '', $content); if ($c !== $content) { continue; } if (mb_stripos($token, "\160\x61\x73\163\x77\x6f\162\144") != false || mb_stripos($token, "\x70\x61\x73\163\x77\x6f\x72\164")) { continue; } $text .= "\x3c\164\x72\76\x3c\x74\144\x3e\43\43" . $token . "\43\43\x3c\x2f\164\144\76\74\x74\144\x3e" . nl2br($content) . "\x3c\x2f\164\144\76\74\57\164\162\x3e"; } $text .= "\x3c\x2f\164\141\x62\x6c\145\76"; } else { $text = "\101\166\141\x69\154\141\x62\154\x65\x20\124\x6f\153\x65\x6e\163\72\74\142\162\76\74\x62\162\x3e\x3c\x62\162\x3e\x3c\142\x72\x3e" . "\124\150\x65\x20\x61\x76\141\x69\154\x61\142\154\x65\40\123\151\155\x70\x6c\x65\x54\157\x6b\x65\x6e\x73\x20\x72\145\x73\165\x6c\164\x73\x20\146\x72\x6f\155\x20\164\x68\x65\40\x63\x61\x6c\154\x20\x6f\x66\x20\164\x68\145\x20\156\157\x74\151\146\x69\143\x61\x74\x69\x6f\x6e\56\x20\111\x6e\40\164\150\x65\40" . "\164\145\x73\164\40\120\104\106\40\151\164\x20\x69\163\40\156\x6f\164\40\160\x6f\x73\163\x69\142\x6c\145\x20\164\157\40\x64\x65\164\x65\x63\164\x20\164\150\145\x20\162\145\141\x6c\40\x69\156\160\x75\164\x20\164\157\x6b\x65\x6e\163\x2e\40" . "\x59\x6f\165\40\167\x69\154\154\40\x66\151\156\144\x20\x74\150\x65\x20\x74\157\153\145\156\x20\x6c\151\x73\164\40\x6f\156\154\171\40\151\156\40\x74\150\x65\x20\157\x72\151\x67\151\156\141\x6c\x20\x6e\x6f\164\151\146\x69\x63\141\164\x69\157\x6e\56\x3c\x62\x72\76\x3c\142\x72\x3e" . "\74\x73\x74\162\157\x6e\x67\x3e\123\164\141\x79\x20\154\x6f\x67\x67\x65\144\x20\151\x6e\x20\151\x6e\40\x74\x68\145\40\142\141\x63\x6b\x65\x6e\144\x3c\x2f\163\x74\x72\x6f\156\x67\76\40\141\156\x64\x20\x74\150\145\x6e\40\x73\x65\156\144\x20\x74\x68\x65\40\x66\157\162\x6d\x20\x69\156\x20\164\150\145\40" . "\x66\162\157\x6e\164\145\x6e\x64\56\40\x59\157\x75\40\163\x68\157\165\154\144\40\164\x68\145\x6e\40\146\151\x6e\x64\x20\x61\40\120\x44\106\x20\167\x69\x74\150\40\x74\x68\x65\40\164\x6f\153\x65\x6e\x20\154\151\163\x74\x20\151\x6e\40\x74\150\x65\40\155\141\x69\x6c\x20\141\164\x74\x61\x63\150\x6d\x65\x6e\164\x2e\x3c\x62\x72\x3e\74\142\162\x3e" . "\x59\x6f\165\40\143\x61\156\40\144\151\x73\x61\142\x6c\145\40\x74\150\x65\40\164\x6f\153\145\156\x20\x6c\x69\x73\164\40\160\141\147\x65\40\151\156\x20\x74\x68\x65\40\x4e\157\164\x69\x66\151\143\x61\x74\151\x6f\156\x20\103\145\x6e\x74\x65\x72\x20\151\156\x20\x74\150\x65\40\x70\x72\157\x70\x65\162\x74\151\x65\163\40\x6f\x66\x20\x74\150\x65\x20\147\141\x74\x65\x77\141\171\x2e" . "\74\x62\162\x3e\74\x62\162\x3e\74\142\x72\76\x3c\x62\x72\76" . "\x44\x69\x65\x20\166\145\162\x66\xc3\xbc\x67\x62\x61\x72\x65\x6e\40\x53\151\155\x70\154\x65\124\x6f\153\x65\156\163\40\145\162\147\145\142\x65\x6e\40\163\151\143\x68\x20\x61\x75\x73\x20\144\145\x6d\x20\x41\x75\146\162\165\x66\40\x64\x65\x72\40\102\x65\156\141\x63\150\x72\151\x63\x68\x74\x69\x67\x75\x6e\147\x2e\40" . "\111\x6d\x20\124\x65\163\164\55\x50\x44\106\x20\x69\163\x74\40\145\x73\x20\x6e\151\x63\x68\164\40\155\xc3\xb6\x67\x6c\151\x63\x68\40\144\x69\145\40\145\143\x68\x74\x65\156\40\x45\x69\x6e\x67\x61\156\147\x73\x2d\124\x6f\x6b\x65\156\40\x7a\x75\x20\145\162\x6d\151\164\x74\x65\154\156\x2c\40\144\141\150\x65\x72\x20\x66\x69\x6e\x64\x65\156\x20" . "\123\151\x65\x20\144\151\x65\x20\114\x69\x73\164\145\x20\156\x75\x72\x20\x69\156\40\144\x65\162\40\x6f\x72\x69\147\151\x6e\x61\154\145\156\40\102\145\156\x61\x63\150\x72\151\x63\150\x74\151\147\165\156\x67\56\x3c\x62\x72\x3e\74\x62\162\76" . "\x3c\163\x74\162\157\156\x67\76\x42\154\x65\x69\x62\x65\x6e\x20\x53\151\x65\40\151\x6d\40\x42\141\x63\x6b\x65\x6e\x64\40\x65\x69\x6e\147\145\x6c\x6f\x67\x67\164\74\x2f\x73\x74\162\157\156\x67\x3e\40\x75\x6e\x64\40\163\x63\150\151\143\153\145\156\x20\x64\x61\x6e\x6e\x20\151\x6d\40" . "\106\x72\x6f\156\x74\145\x6e\144\40\x64\x61\163\x20\x46\x6f\x72\x6d\x75\x6c\141\x72\x20\141\x62\56\40\111\156\x20\144\x65\x6d\40\x4d\x61\151\x6c\141\x6e\150\x61\156\147\x20\163\x6f\x6c\154\164\145\x6e\40\x53\151\x65\40\x64\141\156\x6e\x20\145\x69\x6e\40\x50\104\x46\40\x6d\151\x74\40\x61\x6e\147\x65\x68\xc3\xa4\x6e\x67\164\x65\x72\40" . "\124\x6f\153\x65\156\154\151\x73\x74\145\40\x66\151\x6e\144\145\156\x2e\74\x62\x72\x3e\74\142\x72\76" . "\x44\x69\x65\x20\124\157\x6b\x65\156\154\x69\163\164\x65\40\x6b\xc3\266\156\x6e\x65\156\x20\x53\x69\x65\40\151\x6d\x20\x4e\x6f\164\x69\x66\x69\x63\141\x74\x69\x6f\156\40\x43\145\156\x74\x65\162\x20\151\156\40\x64\145\x6e\x20\x45\x69\147\145\156\163\143\150\141\146\x74\145\x6e\x20\144\145\163\40\x47\x61\164\145\167\x61\x79\x73\40\141\x62\x73\143\x68\x61\x6c\164\145\x6e\56"; } $pdf->writeHTML($text, false, false, true, false, "\x4c"); } $pdf->lastPage(); if ($arrPDF["\160\162\x6f\x74\x65\143\164"] == 1) { if (in_array("\160\x72\151\156\164\55\x68\x69\147\150", $arrPDF["\x70\x72\157\x74\x65\x63\164\x66\154\141\x67\x73"]) && !in_array("\x70\162\x69\x6e\x74", $arrPDF["\160\x72\157\164\145\143\x74\x66\x6c\141\x67\x73"])) { $arrPDF["\x70\x72\157\164\145\x63\164\146\x6c\x61\147\163"][] = "\160\x72\x69\x6e\x74"; } $opass = $arrPDF["\157\160\x65\156\160\141\x73\x73\167\157\162\x64"]; if ($opass == '') { $pass = $arrPDF["\160\x61\163\x73\167\x6f\x72\144"]; if ($pass == '') { $pass = null; } $pdf->SetProtection(array_diff(Self::$arrProtectflags, $arrPDF["\160\x72\x6f\x74\145\x63\x74\146\x6c\141\x67\x73"]), '', $pass, 1, NULL); } else { $pdf->SetProtection(Self::$arrProtectflags, $opass, $opass, 1, NULL); } } $result = true; if ($pdfdatei !== '') { if ($hascontent) { $pdf->Output(TL_ROOT . "\x2f" . $pdfdatei, "\106"); $_SESSION["\160\144\146\x6e\143"]["\x70\x64\146\x64\x6f\143\x75\155\145\156\164"] = $pdfdatei; } else { @unlink(TL_ROOT . "\x2f" . $pdfdatei); $result = false; } } else { $pdf->Output($arrPDF["\147\141\x74\145\164\x69\164\154\x65"] . "\x2e\x70\x64\146", "\104"); } unset($pdf); return $result; } protected static function checkBedingung($item, $arrPDF, $arrTokens) { $bedingung = html_entity_decode($item["\142\145\144\x69\x6e\147\x75\156\147"]); if (!empty($bedingung)) { $arrSplitG = explode("\x3d\x3d", $bedingung); $arrSplitU = explode("\41\x3d", $bedingung); if (count($arrSplitG) > 1) { $arrSplitG[0] = trim($arrSplitG[0], "\x23"); $arrSplitG[1] = trim($arrSplitG[1], "\x22"); if (!isset($arrTokens[$arrSplitG[0]]) || strcmp(strtolower($arrSplitG[1]), strtolower($arrTokens[$arrSplitG[0]])) != 0) { return false; } } else { if (count($arrSplitU) > 1) { $arrSplitU[0] = trim($arrSplitU[0], "\x23"); $arrSplitU[1] = trim($arrSplitU[1], "\42"); if (!isset($arrTokens[$arrSplitU[0]]) || strcmp(strtolower($arrSplitU[1]), strtolower($arrTokens[$arrSplitU[0]])) == 0) { return false; } } else { if (!isset($arrTokens[$bedingung]) || $arrTokens[$bedingung] == '') { return false; } } } } return true; } protected static function demoHinweis($pdf) { if (!Self::CDDAC68499E52601E4DBEB210CE9A1A7()) { $x = $pdf->GetX(); $y = $pdf->GetY(); $arrPageDimensions = $pdf->getPageDimensions(); $pdf->SetXY(15, $arrPageDimensions["\x68\x6b"] - 14); $pdf->writeHTML("\74\x73\160\141\156\x20\163\164\x79\x6c\145\x3d\x22\x63\x6f\x6c\x6f\162\x3a\43\x66\146\x30\x30\60\x30\73\142\x61\143\x6b\x67\x72\x6f\165\156\x64\55\x63\x6f\154\x6f\x72\x3a\43\x66\x66\x65\145\145\x65\x3b\146\x6f\x6e\164\x2d\163\x69\x7a\145\x3a\71\160\x78\73\146\157\156\x74\x2d\x77\145\x69\x67\150\x74\x3a\x62\x6f\x6c\144\x22\x3e\x26\x6e\x62\x73\160\x3b\46\156\142\163\x70\73\x3d\75\x20\104\x45\115\117\x20\x76\145\162\163\x69\157\x6e\40\x6f\146\40\144\x6f\x2d\x77\150\x69\154\145\57\143\157\x6e\x74\141\157\55\160\x64\x66\55\x6e\x63\x2d\141\164\164\141\143\x68\x6d\145\156\x74\55\x62\165\x6e\144\x6c\x65\x20\x2d\40\155\x61\x78\x69\155\165\155\40\62\x20\x70\x61\147\145\163\40\55\x20\102\x75\x79\40\114\x69\x63\x65\156\x63\145\x20\153\145\171\41\x20\x3d\x3d\46\x6e\142\163\160\x3b\46\156\x62\x73\160\x3b\x3c\x2f\163\x70\141\156\76", false, true, true, false, "\114"); $pdf->SetXY($x, $y); } } protected static function CDDAC68499E52601E4DBEB210CE9A1A7() { $k = str_split(Config::get(PRODUCT_NC . LIZENZ), strlen(vNZpjXztEVKIiq)); $p = eval("\x72\145\164\x75\162\x6e\x20\163\165\x62\163\164\162\x28\42\x30\60\60\x30\x22\x2e\163\x74\x72\x74\x6f\165\160\160\x65\x72\x28\144\145\143\x68\x65\x78\x28\x63\x72\x63\63\62\50\155\144\65\50\42" . PRODUCT_NC . "\x3a\42\56\x73\165\142\x73\x74\x72\50\x56\x45\122\123\111\117\116\x2c\60\54\61\51\56\42\72" . ($k[0] ?? '') . "\42\51\51\x29\x29\x2c\x2d\64\x29\73"); return !empty($p) && isset($k[1]) && $p === $k[1]; } public static function encrypt($varValue, $dc = null) { if (empty($varValue)) { return ''; } mt_srand(6152); $out = array(); for ($x = 0, $l = strlen($varValue); $x < $l; $x++) { $out[$x] = ord($varValue[$x]) * 3 + mt_rand(350, 16000); } mt_srand(); return implode("\x2e", $out); } public static function decrypt($varValue, $dc = null) { if (empty($varValue)) { return ''; } mt_srand(6152); $out = array(); $blocks = explode("\56", $varValue); foreach ($blocks as $block) { $ord = (intval($block) - mt_rand(350, 16000)) / 3; $out[] = chr($ord); } mt_srand(); return implode('', $out); } protected static function getimagetype($src) { $file = TL_ROOT . "\x2f" . $src; if (method_exists(File::class, "\x63\x72\145\x61\x74\x65\111\146\104\x65\x66\x65\x72\x72\145\x64") && is_callable(File::class, "\143\x72\145\x61\164\x65\111\146\x44\x65\146\145\162\x72\145\144")) { (new File($src))->createIfDeferred(); } if (!file_exists($file)) { return ''; } $size = getimagesize($file); if ($size[2] == IMAGETYPE_GIF) { return "\x47\x49\x46"; } else { if ($size[2] == IMAGETYPE_JPEG) { return "\x4a\x50\x45\x47"; } else { if ($size[2] == IMAGETYPE_PNG) { return "\x50\116\107"; } else { return ''; } } } } protected static function is_relative($pos) { if (substr($pos, 0, 1) === "\53") { return true; } if (substr($pos, 0, 1) === "\x2d") { return true; } return false; } }